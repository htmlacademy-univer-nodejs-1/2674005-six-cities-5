# Как работать над проектом

## Окружение

Для удобства работы над проектом используются инструменты из **Node.js** и **npm**. Все необходимые настройки произведены. Убедитесь, что на рабочем компьютере установлен актуальный LTS релиз Node.js**. Актуальная версия **Node.js** указана в файле `package.json` в поле `node`. Затем, в терминале, перейдите в директорию с проектом и _единожды_ запустите команду:

```bash
npm install
```

Команда запустит процесс установки зависимостей проекта из **npm**.

### Сценарии

В `package.json` предопределено несколько сценариев.

#### Скомпилировать проект

```bash
npm run compile
```

Создаст директорию `dist` и скомпилирует проект.

#### Удалить скомпилированный проект

```bash
npm run clean
```

Удаляет директорию `dist`. Используется перед компиляцией.

#### Собрать проект

```bash
npm run build
```

Выполняет сборку проекта: удаляет ранее скомпилированный проект и компилирует заново.

#### Проверить линтером

```bash
npm run lint
```

Запуск проверки проекта статическим анализатором кода **ESLint**.

Линтер проверяет файлы только внутри директории `src`.

**Обратите внимание**, при запуске данной команды, ошибки выводятся в терминал.

#### Запустить ts-модуль без компиляции

```bash
npm run ts -- <Путь к модулю с ts-кодом>
```

Пакет `ts-node` позволяет выполнить TS-код в Node.js без предварительной компиляции. Используется только на этапе разработки.

#### Запустить проект

```bash
npm start
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуска результирующего кода.

#### Запустить Mock Server

```bash
npm run mock:server
```

Запускает JSON Server на порту 3000 с тестовыми данными из `mocks/mock-server-data.json`.

## Структура проекта

### Директория `src`

Исходный код проекта: компоненты, модули и так далее. Структура директории `src` может быть произвольной.

### Файл `Readme.md`

Инструкции по работе с учебным репозиторием.

### Файл `Contributing.md`

Советы и инструкции по внесению изменений в учебный репозиторий.

### Остальное

Все остальные файлы в проекте являются служебными. Пожалуйста, не удаляйте и не изменяйте их самовольно. Только если того требует задание или наставник.

## Переменные окружения

Для работы приложения необходимо настроить переменные окружения. В корне проекта создайте файл `.env` на основе `.env-example`.

### Список переменных окружения

- `PORT=4000` — порт, на котором запускается REST API сервер
- `DB_HOST=mongodb://admin:test@localhost:27017/six-cities?authSource=admin` — строка подключения к MongoDB с учетными данными для аутентификации
- `SALT=secret_salt_string_example` — соль для хеширования паролей пользователей
- `UPLOAD_DIRECTORY=upload` — директория для загрузки файлов (аватары, изображения)
- `JWT_SECRET=your_jwt_secret_key_here` — секретный ключ для подписи JWT токенов

## Запуск проекта

### Требования

- Node.js версии, указанной в `package.json`
- MongoDB (можно запустить через Docker, см. `docker-compose.yml`)

### Шаги для запуска

1. Установите зависимости:
```bash
npm install
```

2. Запустите MongoDB (если используете Docker):
```bash
docker-compose up -d
```

3. Создайте `.env` файл на основе `.env-example` и заполните переменные окружения:
```bash
cp .env-example .env
```

Отредактируйте `.env` файл, указав реальные значения для секретов (SALT и JWT_SECRET).

4. Соберите проект:
```bash
npm run build
```

5. Запустите сервер:
```bash
npm start
```

Сервер будет доступен по адресу `http://localhost:4000` (или на порту, указанном в `.env`).

### Режим разработки

Для запуска в режиме разработки с красивым выводом логов:
```bash
npm run dev
```

## CLI Приложение

### Команды

```bash
node dist/main.js --help                    # Справка по командам
node dist/main.js --version                 # Версия приложения
node dist/main.js --import <path> [dbUri]   # Импорт данных из TSV файла в MongoDB
node dist/main.js --generate <n> <path> <url> # Генерация тестовых данных
```

Пример генерации:

```bash
node dist/main.js --generate 100 ./mocks/test.tsv http://localhost:3000/mock-data
```

Пример импорта:

```bash
node dist/main.js --import ./test-import.tsv "mongodb://admin:test@localhost:27017/six-cities?authSource=admin"
```

### Формат TSV

Поля через TAB: title, description, publishDate, city, previewImage, images (6 шт через ;), isPremium, isFavorite, rating, type, rooms, guests, price, amenities (через ;), userEmail, userName, userLastName, userPassword, userAvatar, userType, commentsCount, location (lat;lon).

### Структура

- `src/cli/` - CLI приложение и команды
- `src/shared/types/` - типы и енамы (City, HousingType, Amenity, User, Offer, Location)
- `src/shared/libs/file-reader/` - чтение и парсинг TSV файлов
- `mocks/offers.tsv` - тестовые данные
